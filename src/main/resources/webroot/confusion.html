<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>混淆工具</title>
    <script src="./confusionRoot.js"></script>
    <script src="./confusion.js"></script>
    <script src="./layui/layui.js"></script>
    <link href="./layui/css/layui.css">
    <style>
        #body {
            display: flex;
            flex-direction: column;
            align-content: center;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;

        }

        main {
            display: flex;
            /* width: 80vh; */
            flex-wrap: wrap;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }

        .xz {
            border: #1e9fff solid;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: space-evenly;
            align-items: center;
            flex-direction: row;
            margin: 10px;
            /*width: 80vh;*/
        }

        .xz > * {
            margin: 10px;
        }

        main > .layui-panel {
            margin: 10px;
        }
    </style>
</head>
<body>
<div id="body">
    <main>
        <div class="xz">
            <div class="layui-panel">
                <span>压缩代码</span>
                <select id="compact" lay-verify="">
                    <option value="true">true</option>
                    <option value="false">false</option>
                </select>
            </div>
        </div>

        <div class="xz">
            <div class="layui-panel">
                <span title="控制流扁平化是一种阻碍程序理解的源代码结构转换">启用代码控制流扁平化</span>
                <select id="controlFlowFlattening" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
            </div>
            <div class="layui-panel">
                <span title="此设置对于大型代码特别有用，因为大量控制流转换会减慢代码速度并增加代码大小">扁平化使用概率</span>
                <input type="number" id="controlFlowFlatteningThreshold" value="0.75">
            </div>
        </div>

        <div class="xz">
            <div class="layui-panel">
                <span title="显着增加混淆代码的大小">插入死代码</span>
                <select id="deadCodeInjection" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
            </div>
            <div class="layui-panel">
                <span title="">死代码影响率</span>
                <input type="number" id="deadCodeInjectionThreshold" value="0.4">
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="console.log禁用、console.info、 console.error、console.warn、的使用console.debug，console.exception并console.trace用空函数替换它们">禁用console</span>
                <select id="disableConsoleOutput" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="防止导入混淆require">防止导入混淆require</span>
                <select id="ignoreImports" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
            </div>
            <div class="layui-panel">
                <span title="inputFileName">inputFileName</span>
                <input type="text" id="inputFileName">
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="numbersToExpressions">将字符串转化为表达式</span>
                <select id="numbersToExpressions" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
            </div>
        </div>

        <div class="xz">
            <div class="layui-panel">
                <span title="使用预设后你不应该动其他参数了">使用预设</span>
                <select id="optionsPreset" lay-verify="">
                    <option value="default">default</option>
                    <option value="low-obfuscation">最低混淆</option>
                    <option value="medium-obfuscation">中等混淆</option>
                    <option value="high-obfuscation">最高混淆</option>
                </select>
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="允许使用声明来混淆全局变量和函数名称【这个选项可能会破坏你的代码】">允许使用声明来混淆全局变量和函数名称</span>
                <select id="renameGlobals" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
                <span title="启用属性名称重命名。所有内置 DOM 属性和核心 JavaScript 类中的属性都将被忽略。">启用属性名称重命名</span>
                <select id="renameProperties" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
            </div>
        </div>

        <div class="xz">
            <div class="layui-panel">
                <span title="seed">seed</span>
                <input id="seed" type="number" value="0">
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="simplify">通过简化启用额外的代码混淆</span>
                <select id="simplify" lay-verify="">
                    <option value="true">true</option>
                    <option value="false">false</option>
                </select>
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="启用混淆代码的源映射生成">启用混淆代码的源映射生成</span>
                <select id="sourceMap" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
                <span title="sourceMapBaseUrl">sourceMapBaseUrl</span>
                <input id="sourceMapBaseUrl" type="text" value="">
                <span title="sourceMapFileName">sourceMapFileName</span>
                <input id="sourceMapFileName" type="text" value="">
                <span title="separate">separate</span>
                <input id="separate" type="text" value="separate">
                <span title="sourceMapSourcesMode">sourceMapSourcesMode</span>
                <input id="sourceMapSourcesMode" type="text" value="sources-content">
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="将文字字符串拆分为具有splitStringsChunkLength选项值长度的块。">字符串块结构</span>
                <select id="splitStrings" lay-verify="">
                    <option value="false">false</option>
                    <option value="true">true</option>
                </select>
                <span title="splitStringsChunkLength">设置块长度。</span>
                <input id="splitStringsChunkLength" type="text" value="1">
            </div>
        </div>


        <div class="xz">
            <div class="layui-panel">
                <span title="删除字符串文字并将它们放入特殊数组中。">转换特殊字符串</span>
                <select id="stringArray" lay-verify="">
                    <option value="true">true</option>
                    <option value="false">false</option>
                </select>
                <span title="调用的所有参数都可以根据值提取到不同的对象stringArrayCallsTransformThreshold。">特殊字符串对象（转换特殊字符串必须启用）</span>
                <select id="stringArrayCallsTransform" lay-verify="">
                    <option value="true">true</option>
                    <option value="false">false</option>
                </select>
                <span title="您可以使用此设置来调整对字符串数组的调用被转换的概率（从 0 到 1）。">转换率</span>
                <input type="number" id="stringArrayCallsTransformThreshold" value="0.5">
            </div>
        </div>

        <div class="xz">
            <div class="layui-panel">
                <span title="删除字符串文字并将它们放入特殊数组中。">字符串加密</span>
                <select id="stringArrayEncoding" lay-verify="">
                    <option value="none">none</option>
                    <option value="base64">base64</option>
                    <option value="rc4">rc4</option>
                </select>
            </div>
        </div>

    </main>
</div>
<hr class="layui-border-red">
<button onclick="finished() ">完成</button>

<div>
    <h2 class="layui-colla-title">配置文件输出</h2>
    <textarea id="jsonOut"></textarea>
</div>

</body>
<script>
    function finished() {
        setValue("compact");

        setValue("controlFlowFlattening");
        setValue("controlFlowFlatteningThreshold");

        setValue("deadCodeInjection");
        setValue("deadCodeInjectionThreshold");

        setValue("disableConsoleOutput");

        setValue("ignoreImports");
        setValue("inputFileName");

        setValue("numbersToExpressions");

        setValue("optionsPreset");

        setValue("renameGlobals");
        setValue("renameProperties");

        setValue("seed");

        setValue("simplify");

        setValue("sourceMap");
        setValue("sourceMapBaseUrl");
        setValue("sourceMapFileName");
        setValue("separate");
        setValue("sourceMapSourcesMode");

        setValue("splitStringsChunkLength");

        setValue("stringArray");
        setValue("stringArrayCallsTransform");
        setValue("stringArrayCallsTransformThreshold");

        setValue("stringArrayEncoding");
        // console.log(options)

        // 发起GET请求
        fetch('/api/files')
            .then(function (response) {
                if (!response.ok) {
                    // 请求失败，抛出一个错误
                    throw new Error('Network response was not ok');
                }
                // 将响应数据解析为JSON
                return response.json();
            })
            .then(function (data) {
                // 处理解析后的数据
                console.log(data);
                let text = data.text;
                for (let item of text) {
                    text
                }
            })
            .catch(function (error) {
                // 处理错误
                console.error('Fetch error:', error);
            });

    }

    function setValue(id) {
        options[id] = document.getElementById(id).value;
        console.log(id + ": " + options[id] + "=>" + document.getElementById(id).value)
    }

</script>
</script>
</html>